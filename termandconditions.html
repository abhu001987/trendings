<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Paccy Platformer – Final</title>
<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#64b5f6;
}
#game{
  width:100vw;
  height:100vh;
  position:relative;
  overflow:hidden;
}
#world{
  position:absolute;
  width:6000px;
  height:100%;
}

/* PLAYER SPRITE */
#player{
  position:absolute;
  width:80px;
  height:120px;
  background:url("https://studymate81.wordpress.com/wp-content/uploads/2026/01/image_of_paccy_as_hero-removebg-preview.png") no-repeat center/contain;
  pointer-events:none;
}

/* GROUND */
.ground{
  position:absolute;
  bottom:0;
  height:80px;
  width:6000px;
  background:#228b22;
}

/* BOX PLATFORM */
.block{
  position:absolute;
  width:80px;
  height:80px;
  background:#8b4513;
  border:3px solid #5a2d0c;
}
</style>
</head>
<body>

<div id="game">
  <div id="world">
    <div class="ground"></div>

    <!-- PLAYER -->
    <div id="player"></div>

    <!-- PLATFORMS -->
    <div class="block" style="left:400px; top:420px"></div>
    <div class="block" style="left:600px; top:340px"></div>
    <div class="block" style="left:800px; top:260px"></div>
    <div class="block" style="left:1100px; top:420px"></div>
  </div>
</div>

<script>
/* =============================
   PHYSICS CONSTANTS (MARIO STYLE)
============================= */
const DOWN_FORCE = 2;
const ACCELERATION = 1.3;
const DAMPENING = 0.75;
const JUMP_IMPULSE = -35;

/* HITBOX SIZE (LOGIC) */
const HITBOX_W = 60;
const HITBOX_H = 80;

/* SPRITE OFFSET (VISUAL FIX) */
const SPRITE_FOOT_OFFSET = 20;

/* =============================
   ELEMENTS
============================= */
const world = document.getElementById("world");
const playerEl = document.getElementById("player");
const blocks = document.querySelectorAll(".block");

/* =============================
   PLAYER STATE
============================= */
const groundY = window.innerHeight - 80;

let player = {
  x: 200,
  y: groundY - HITBOX_H,
  vx: 0,
  vy: 0,
  grounded: true,
  facing: "right"
};

/* =============================
   INPUT
============================= */
const keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* =============================
   COLLISION
============================= */
function rectsOverlap(a,b){
  return a.x < b.x + b.w &&
         a.x + a.w > b.x &&
         a.y < b.y + b.h &&
         a.y + a.h > b.y;
}

/* =============================
   GAME LOOP
============================= */
function update(){
  /* INPUT → IMPULSE */
  if(keys["a"]){
    player.vx -= ACCELERATION;
    player.facing = "left";
  }
  if(keys["d"]){
    player.vx += ACCELERATION;
    player.facing = "right";
  }

  if(keys["w"] && player.grounded){
    player.vy += JUMP_IMPULSE;
    player.grounded = false;
  }

  /* GRAVITY */
  player.vy += DOWN_FORCE;

  /* APPLY VELOCITY */
  player.x += player.vx;
  player.y += player.vy;

  /* FRICTION */
  player.vx *= DAMPENING;

  /* GROUND COLLISION */
  player.grounded = false;
  if(player.y + HITBOX_H >= groundY){
    player.y = groundY - HITBOX_H;
    player.vy = 0;
    player.grounded = true;
  }

  /* PLATFORM COLLISION */
  blocks.forEach(b=>{
    const br = b.getBoundingClientRect();
    const wr = world.getBoundingClientRect();

    const box = {
      x: br.left - wr.left,
      y: br.top - wr.top,
      w: 80,
      h: 80
    };

    const p = {
      x: player.x,
      y: player.y,
      w: HITBOX_W,
      h: HITBOX_H
    };

    if(rectsOverlap(p,box)){
      // landing on top
      if(player.vy > 0 && p.y + p.h - player.vy <= box.y){
        player.y = box.y - HITBOX_H;
        player.vy = 0;
        player.grounded = true;
      }
      // hitting from sides
      else if(player.vx > 0){
        player.x = box.x - HITBOX_W;
      }
      else if(player.vx < 0){
        player.x = box.x + box.w;
      }
    }
  });

  /* CAMERA */
  world.style.transform = `translateX(${-player.x + 200}px)`;

  /* RENDER (WITH FOOT OFFSET) */
  playerEl.style.left = player.x + "px";
  playerEl.style.top = (player.y - SPRITE_FOOT_OFFSET) + "px";
  playerEl.style.transform =
    player.facing === "left" ? "scaleX(-1)" : "scaleX(1)";

  requestAnimationFrame(update);
}

update();
</script>

</body>
</html>

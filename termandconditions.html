<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Paccy Platformer</title>
<style>
html,body{
    margin:0;
    padding:0;
    overflow:hidden;
    background:#87ceeb;
}
#game{
    position:relative;
    width:100vw;
    height:100vh;
    overflow:hidden;
}
#world{
    position:absolute;
    height:100%;
}

/* PLAYER */
#player{
    position:absolute;
    width:80px;
    height:100px;
    background:url('https://studymate81.wordpress.com/wp-content/uploads/2026/01/image_of_paccy_as_hero-removebg-preview.png') no-repeat center/contain;
    z-index:10;
}

/* GROUND */
.ground{
    position:absolute;
    bottom:0;
    width:200px;
    height:80px;
    background:#228b22;
}

/* BOX */
.block{
    position:absolute;
    width:80px;
    height:80px;
    background:#8b4513;
    border:3px solid #5a2d0c;
}
</style>
</head>
<body>

<div id="game">
  <div id="world">
    <div id="player"></div>
  </div>
</div>

<script>
/* =====================
   CONSTANTS
===================== */
const TILE_W = 200;
const GROUND_H = 80;
const BOX_SIZE = 80;
const PLAYER_W = 80;
const PLAYER_H = 100;

/* =====================
   ELEMENTS
===================== */
const world = document.getElementById("world");
const player = document.getElementById("player");

/* =====================
   PLAYER STATE
===================== */
let x = 100;
let y = window.innerHeight - GROUND_H - PLAYER_H;
let vx = 0;
let vy = 0;
let onGround = true;

/* =====================
   JUMP SYSTEM (FIXED)
===================== */
let jumpStepsUsed = 0;
const MAX_JUMP_STEPS = Math.floor(window.innerHeight / BOX_SIZE);

/* =====================
   PHYSICS
===================== */
const gravity = 1.2;
const speed = 5;
const keys = {};

/* INPUT */
document.addEventListener("keydown", e=>{
    const k = e.key.toLowerCase();
    if(!keys[k]){
        // KEY PRESS (not hold)
        if(k === "w" && jumpStepsUsed < MAX_JUMP_STEPS){
            vy = -BOX_SIZE;
            jumpStepsUsed++;
            onGround = false;
        }
    }
    keys[k] = true;
});
document.addEventListener("keyup", e=>{
    keys[e.key.toLowerCase()] = false;
});

/* =====================
   INFINITE GROUND (FIXED)
===================== */
const groundTiles = [];
const GROUND_TILE_COUNT = Math.ceil(window.innerWidth / TILE_W) + 3;

for(let i=0;i<GROUND_TILE_COUNT;i++){
    const g = document.createElement("div");
    g.className = "ground";
    g.dataset.index = i;
    g.style.left = (i * TILE_W) + "px";
    world.appendChild(g);
    groundTiles.push(g);
}

/* =====================
   BOXES
===================== */
const boxes = [];
function addBox(x,y){
    const b = document.createElement("div");
    b.className = "block";
    b.style.left = x+"px";
    b.style.top = y+"px";
    world.appendChild(b);
    boxes.push(b);
}

for(let i=1;i<=12;i++){
    addBox(i*500, window.innerHeight - GROUND_H - BOX_SIZE);
    addBox(i*600, window.innerHeight - GROUND_H - 200);
}

/* =====================
   COLLISION
===================== */
function collide(a,b){
    return a.x < b.x+b.w &&
           a.x+a.w > b.x &&
           a.y < b.y+b.h &&
           a.y+a.h > b.y;
}

/* =====================
   GAME LOOP
===================== */
function update(){
    /* INPUT */
    vx = 0;
    if(keys["a"]) vx = -speed;
    if(keys["d"]) vx = speed;
    if(keys["s"]) vy += 2;

    /* PHYSICS */
    vy += gravity;
    x += vx;
    y += vy;
    onGround = false;

    const groundY = window.innerHeight - GROUND_H;

    /* GROUND COLLISION */
    if(y + PLAYER_H >= groundY){
        y = groundY - PLAYER_H;
        vy = 0;
        onGround = true;
        jumpStepsUsed = 0;
    }

    /* BOX COLLISION */
    boxes.forEach(b=>{
        const bx = parseInt(b.style.left);
        const by = parseInt(b.style.top);

        const p = {x,y,w:PLAYER_W,h:PLAYER_H};
        const box = {x:bx,y:by,w:BOX_SIZE,h:BOX_SIZE};

        if(collide(p,box)){
            if(vy > 0 && p.y + p.h - vy <= box.y){
                y = box.y - PLAYER_H;
                vy = 0;
                onGround = true;
                jumpStepsUsed = 0;
            }
            else if(vy < 0 && p.y >= box.y + box.h){
                y = box.y + box.h;
                vy = 0;
            }
            else if(vx > 0){
                x = box.x - PLAYER_W;
            }
            else if(vx < 0){
                x = box.x + box.w;
            }
        }
    });

    /* INFINITE GROUND RECYCLE (FINAL FIX) */
    const cameraTile = Math.floor((x - 200) / TILE_W);

    groundTiles.forEach(g=>{
        let idx = parseInt(g.dataset.index);
        if(idx < cameraTile - 1){
            idx += GROUND_TILE_COUNT;
            g.dataset.index = idx;
            g.style.left = (idx * TILE_W) + "px";
        }
    });

    /* CAMERA */
    world.style.transform = `translateX(${-x + 200}px)`;

    /* RENDER */
    player.style.left = x+"px";
    player.style.top = y+"px";

    requestAnimationFrame(update);
}

update();
</script>

</body>
</html>

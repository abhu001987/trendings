<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Paccy Mario Physics</title>
<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#64b5f6;
}
#game{
  width:100vw;
  height:100vh;
  position:relative;
}
#world{
  position:absolute;
  width:5000px;
  height:100%;
}
.player{
  position:absolute;
  width:80px;
  height:100px;
  background-size:contain;
  background-repeat:no-repeat;
}
.ground{
  position:absolute;
  bottom:0;
  height:80px;
  width:5000px;
  background:#228b22;
}
.block{
  position:absolute;
  width:80px;
  height:80px;
  background:#8b4513;
}
</style>
</head>
<body>

<div id="game">
  <div id="world">
    <div class="ground"></div>

    <!-- PLAYER -->
    <div id="player" class="player"></div>

    <!-- PLATFORMS -->
    <div class="block" style="left:500px; top:420px"></div>
    <div class="block" style="left:700px; top:340px"></div>
    <div class="block" style="left:900px; top:260px"></div>
  </div>
</div>

<script>
/* =============================
   CONSTANTS (FROM YOUR REFERENCE)
============================= */
const DOWN_FORCE = 2;
const ACCELERATION = 1.3;
const DAMPENING = 0.75;
const JUMP_IMPULSE = -35;

/* =============================
   ELEMENTS
============================= */
const world = document.getElementById("world");
const playerEl = document.getElementById("player");
const blocks = document.querySelectorAll(".block");

/* =============================
   PLAYER STATE
============================= */
let player = {
  x: 200,
  y: 0,              // TEMP, fixed below
  vx: 0,
  vy: 0,
  grounded: false,
  state: "idle",
  facing: "right"
};

/* SPAWN PLAYER ON GROUND (IMPORTANT FIX) */
const groundY = window.innerHeight - 80;
player.y = groundY - 100;

/* =============================
   PLAYER SPRITES (YOUR IMAGE)
============================= */
const sprites = {
  idle: "https://studymate81.wordpress.com/wp-content/uploads/2026/01/image_of_paccy_as_hero-removebg-preview.png",
  running: "https://studymate81.wordpress.com/wp-content/uploads/2026/01/image_of_paccy_as_hero-removebg-preview.png",
  jumping: "https://studymate81.wordpress.com/wp-content/uploads/2026/01/image_of_paccy_as_hero-removebg-preview.png"
};

function setState(state){
  if(player.state !== state){
    player.state = state;
    playerEl.style.backgroundImage = `url(${sprites[state]})`;
  }
}

/* =============================
   INPUT
============================= */
const keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* =============================
   COLLISION
============================= */
function collide(a,b){
  return a.x < b.x+b.w &&
         a.x+a.w > b.x &&
         a.y < b.y+b.h &&
         a.y+a.h > b.y;
}

/* =============================
   GAME LOOP (MARIO STYLE)
============================= */
function update(){
  /* INPUT â†’ IMPULSES */
  if(keys["a"]){
    player.vx -= ACCELERATION;
    player.facing = "left";
  }
  if(keys["d"]){
    player.vx += ACCELERATION;
    player.facing = "right";
  }

  if(keys["w"] && player.grounded){
    player.vy += JUMP_IMPULSE;
    player.grounded = false;
    setState("jumping");
  }

  /* GRAVITY */
  player.vy += DOWN_FORCE;

  /* APPLY VELOCITY */
  player.x += player.vx;
  player.y += player.vy;

  /* DAMPENING */
  player.vx *= DAMPENING;

  /* GROUND COLLISION */
  player.grounded = false;
  if(player.y + 100 >= groundY){
    player.y = groundY - 100;
    player.vy = 0;
    player.grounded = true;
  }

  /* BLOCK COLLISION */
  blocks.forEach(b=>{
    const r = b.getBoundingClientRect();
    const wr = world.getBoundingClientRect();
    const box = {
      x: r.left - wr.left,
      y: r.top - wr.top,
      w: 80,
      h: 80
    };
    const p = {x:player.x,y:player.y,w:80,h:100};

    if(collide(p,box)){
      if(player.vy > 0){
        player.y = box.y - 100;
        player.vy = 0;
        player.grounded = true;
      }
    }
  });

  /* ANIMATION STATE */
  if(player.grounded){
    if(keys["a"] || keys["d"]) setState("running");
    else setState("idle");
  }

  /* CAMERA (SAFE OFFSET) */
  world.style.transform = `translateX(${-player.x + 200}px)`;

  /* RENDER */
  playerEl.style.left = player.x + "px";
  playerEl.style.top = player.y + "px";
  playerEl.style.transform =
    player.facing === "left" ? "scaleX(-1)" : "scaleX(1)";

  requestAnimationFrame(update);
}

setState("idle");
update();
</script>

</body>
</html>
